!function(n){"use strict";var l="#fw-wizard-container",t="#fw-elements-container",a="color: white; background-color: purple; padding: 3px; display: block; line-height: 25px; border-radius: 2px;";function r(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];window.console&&console.log.apply(console,["%cMSF",a].concat(e))}function o(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];window.console&&console.warn.apply(console,["%cMSF",a].concat(e))}function c(e,i){n('<div id="fw-alert" style="background-color:'+(i?"#4caf50":"#f44336")+'">'+e+"</div>").hide().appendTo("#wpbody-content").slideDown().delay(3e3).slideUp()}function s(e,i){var t='<div class="fw-radio-option-element" data-type="option">';return t+='<input type="text" class="fw-radio-option" placeholder="'+wizard.i18n.radio.option+" "+i+'" value="'+function(e){return(""+e).replace(/\\/g,"\\\\").replace(/"/g,"&quot;")}(e)+'"></input>',t+='<div class="fw-remove-radio-option"><i class="fa fa-minus-circle" aria-hidden="true"></i></div></div>'}function d(e){var i='<div class="fw-step-block" data-type="'+e.type+'" >';switch(i+='<div class="fw-block-controls">',i+='<i class="fa fa-remove fw-remove-block" title="'+wizard.i18n.tooltips.removeBlock+'" aria-hidden="true"></i>',i+='<i class="fa fa-caret-up fw-toggle-block" aria-hidden="true"></i>',i+="</div>",i+=function(e){var i='<div class="fw-block-action fw-block-hndle">';return i+='<i class="fa fa-arrows fw-move-block fw-block-hndle" aria-hidden="true"></i>',i+="<h4>"+e+"</h4>",i+="</div>"}(e.type),i+='<div class="fw-block-fields">',e.type){case"radio":e.elements||(e.elements=[{type:"header",value:""},{type:"option",value:""}]),i+=function(e){var i,t,a,l,n,r=0,o="";for(o+='<div class="fw-radio-option-container">',i=0,t=e.elements.length;i<t;i++)"option"===(a=e.elements[i]).type?(1==i&&(o+="<label>"+wizard.i18n.radio.options+"</label>"),o+=s(a.value,1+r++)):o+=(l=a.value,n=void 0,n='<div class="fw-radio-option-element" data-type="header"><label>'+wizard.i18n.label+"</label>",n+='<input type="text" class="fw-radio-header fw-block-label" value="'+l+'"></input>',n+="</div>");return o+="</div>",o+='<button class="fw-radio-add"><i class="fa fa-plus" aria-hidden="true"></i> '+wizard.i18n.radio.addOption+"</button><br/>",o+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/> "+wizard.i18n.required+"</label>","true"==e.multichoice?o+='<label><input type="checkbox" class="fw-radio-multichoice" checked/>'+wizard.i18n.radio.multiple+' <i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.tooltips.multiChoice+'"></i></label>':o+='<label><input type="checkbox" class="fw-radio-multichoice"/>'+wizard.i18n.radio.multiple+' <i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.tooltips.multiChoice+'"></i></label>',o}(e);break;case"select":e.elements||(e.elements=[]),i+=function(e){r("select",e);var i=0,t="",a=wizard.i18n.select.placeholder?wizard.i18n.select.placeholder:"";for(t+='<div class="fw-select-option-container">',t+="<label>"+wizard.i18n.label+"</label>",t+='<input type="text" class="fw-block-label" value="'+e.label+'"></input>',t+="<label>"+a+"</label>",t+='<input type="text" class="fw-select-placeholder" value="'+e.placeholder+'"></input>',t+="<label>"+wizard.i18n.select.options+"</label>",t+='<textarea class="fw-select-options" rows="4" cols="50">',i=0;i<e.elements.length;i++)t+=e.elements[i]+"\n";return t+="</textarea>",t+="</div>",t+='<label><input type="checkbox" class="fw-select-search"'+y(e.search)+"/>"+wizard.i18n.select.search+"</label>",t+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/> "+wizard.i18n.required+"</label>"}(e);break;case"checkbox":i+=function(e){r("checkbox",e);var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-text-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"text":i+=function(e){r("textInput",e);var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-text-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"email":i+=function(e){var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-text-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"numeric":i+=function(e){var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-text-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>",i+="<label>"+wizard.i18n.numeric.minimum+"</label>",i+='<input type="text" class="fw-numeric-minimum fw-block-label" placeholder="'+wizard.i18n.numeric.no_minimum+'" value="'+(e.minimum?e.minimum:"")+'" pattern="-?\\d*"></input><br/><br/>',i+="<label>"+wizard.i18n.numeric.maximum+"</label>",i+='<input type="text" class="fw-numeric-maximum fw-block-label" placeholder="'+wizard.i18n.numeric.no_maximum+'" value="'+(e.maximum?e.maximum:"")+'" pattern="-?\\d*"></input><br/>'}(e);break;case"file":i+=function(e){var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-text-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+='<label><input type="checkbox" class="fw-file-multi"'+y(e.multi)+"/>"+wizard.i18n.multifile+"</label>",i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"date":i+=function(e){var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-text-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+="<label>"+wizard.i18n.dateformat+'<a target="_blank" href="http://t1m0n.name/air-datepicker/docs/#sub-section-9"><i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.tooltips.dateformat+'"></i></a></label>',i+='<input type="text" class="fw-date-format fw-block-label" placeholder="'+wizard.i18n.dateformat+'" value="'+(e.format?e.format:"yy-mm-dd")+'" ></input><br/>',i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"textarea":i+=function(e){r("textArea",e);var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-textarea-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"paragraph":i+=function(e){var i="";return i+="<label>"+wizard.i18n.paragraph.textHtml+' <i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.tooltips.paragraph+'"></i></label>',i+='<textarea class="fw-paragraph-text fw-block-label" placeholder="'+wizard.i18n.paragraph.text+'">'+(e.text?e.text:"")+"</textarea>",i+='<label style="display:none;"><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"media":i+=function(e){var i="";return i+="<label>"+wizard.i18n.media.title+' <i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.media.tooltip+'"></i></label>',i+='<div style="float:left; width: 49%;"><label>'+wizard.i18n.media.file_title+"</label>",i+='<input style="width: 90%" type="text" disabled class="fw-media-element-title fw-block-label" value=""></input><br/></div>',i+='<div style="float: left; width: 49%;"><label>'+wizard.i18n.media.file_name+"</label>",i+='<input style="width: 90%" type="text" disabled class="fw-media-element-filename fw-block-label" value=""></input><br/></div>',i+='<br style="clear: both;" />',i+="<label>"+wizard.i18n.media.preview+"</label>",i+='<div class="fw-media-preview-wrapper"><img class="fw-media-preview" src="" height="100" style="height: 100px; width: auto; max-width: 100%;"></div>',i+='<input type="hidden" name="fw-media-element" class="fw-media-element" value="'+(e.attachmentId?e.attachmentId:0)+'" class="regular-text" />',i+='<input type="button" class="button-primary fw-media-select" value="'+wizard.i18n.media.select+'"/><br /><br />',i+='<label style="display:none;"><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"regex":i+=function(e){var i="";return i+="<label>"+wizard.i18n.label+"</label>",i+='<input type="text" class="fw-text-label fw-block-label" placeholder="'+wizard.i18n.label+'" value="'+e.label+'"></input><br/>',i+="<label>"+wizard.i18n.filter+"</label>",i+='<input type="text" class="fw-regex-filter fw-block-label" placeholder="'+wizard.i18n.filter+'" value="'+(e.filter?e.filter:"")+'"></input><br/>',i+="<label>"+wizard.i18n.filterError+"</label>",i+='<input type="text" class="fw-regex-error fw-block-label" placeholder="'+wizard.i18n.filterError+'" value="'+(e.customError?e.customError:"")+'"></input><br/>',i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>"}(e);break;case"registration":i+=function(e){var i="";return i+='<label><input type="checkbox" class="fw-required"'+y(e.required)+"/>"+wizard.i18n.required+"</label>",i+='<p class="msfp-registration-info">'+wizard.i18n.registration.info+"</p>",i+='<label class="msfp-registration-option"><input type="checkbox" class="msfp-registration-email" checked disabled="disabled"/>'+wizard.i18n.registration.email+"</label>",i+='<label class="msfp-registration-option"><input type="checkbox" class="msfp-registration-username" checked disabled="disabled"/>'+wizard.i18n.registration.username+"</label>",i+='<label class="msfp-registration-option"><input type="checkbox" class="msfp-registration-password"'+y(e.password)+"/>"+wizard.i18n.registration.password+"</label>",i+='<label class="msfp-registration-option"><input type="checkbox" class="msfp-registration-firstname"'+y(e.firstname)+"/>"+wizard.i18n.registration.firstname+"</label>",i+='<label class="msfp-registration-option"><input type="checkbox" class="msfp-registration-lastname"'+y(e.lastname)+"/>"+wizard.i18n.registration.lastname+"</label>",i+='<label class="msfp-registration-option"><input type="checkbox" class="msfp-registration-website"'+y(e.website)+"/>"+wizard.i18n.registration.website+"</label>",i+='<label class="msfp-registration-option"><input type="checkbox" class="msfp-registration-bio"'+y(e.bio)+"/>"+wizard.i18n.registration.bio+"</label>"}(e)}return i+="</div>",i+='<div class="fw-clearfix"></div>',i+="</div>"}function f(e,i){r("part",e);var t='<div class="'+i+'">';return t+='<div class="fw-section-hndle"><i class="fa fa-arrows"></i></div>',t+='<input type="text" class="fw-part-title" value="'+e.title+'" placeholder="'+wizard.i18n.partTitle+'"></input>',t+='<div class="fw-remove-part" title="'+wizard.i18n.removeSection+'">',t+='<i class="fa fa-remove"></i>',t+='</div><div class="inside connectedSortable">',t+=function(e){var i,t,a="";for(i=0,t=e.length;i<t;i++)if("conditional"==e[i].type){a+=d(e[i].block);var l={prec_block_id:e[i].prec_block_id,prec_operator:e[i].prec_operator,prec_value:e[i].prec_value,visible:e[i].visible};a=a.slice(0,-6),a+='<input class="msf-block-meta" name="msf-block-meta-'+i+'" type="hidden" value="'+encodeURI(JSON.stringify(l))+'">',a+="</div>"}else a+=d(e[i]);return a}(e.blocks),t+='</div><div class="fw-add-element">',t+='<a href="#TB_inline?width=400&height=200&inlineId=fw-thickbox-content" class="thickbox"><i class="fa fa-plus"></i> '+wizard.i18n.addElement+"</a>",t+="</div>",t+="</div>"}function p(e,i){var t="fw-headline-"+i,a="fw-copy-text-"+i,l='<div class="fw-step"><div class="form-wrap">';return l+='<div class="input form-field">',l+='<label for="'+("fw-title-"+i)+'"><b>'+wizard.i18n.title+"</b>",l+='<i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.tooltips.title+'"></i></label>',l+='<input type="text" class="fw-step-title" value="'+e.title+'"></input>',l+="</div>",l+='<div class="input form-field">',l+='<label for="'+t+'"><b>'+wizard.i18n.headline+"</b>",l+='<i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.tooltips.headline+'"></i></label>',l+='<input type="text" class="fw-step-headline" value="'+e.headline+'"></input>',l+="</div>",l+='<div class="input form-field">',l+='<label for="'+a+'"><b>'+wizard.i18n.copyText+"</b>",l+='<i class="fa fa-info-circle" aria-hidden="true" title="'+wizard.i18n.copyText+'"></i></label>',l+='<input type="text" class="fw-step-copy_text" value="'+e.copy_text+'"></input>',l+="</div>",l+='<div class="fw-step-parts">'+function(e){var i,t=e.length,a='<div><div class="fw-parts-header"><h3>'+wizard.i18n.sections+"</h3></div>";for(a+='<div class="fw-column-buttons">',a+='<button type="button" class="fw-button-one-column"><i class="fa fa-align-justify"></i></button>',a+='<button type="button" class="fw-button-two-columns"><i class="fa fa-align-justify"></i> <i class="fa fa-align-justify"></i></button>',a+="</div>",a+='<div class="fw-parts-container">',i=0,t=e.length;i<t;i++)a+=f(e[i],"fw-step-part");return a+="</div>",a+='<div class="fw-parts-footer">',a+='<a class="fw-add-part"><i class="fa fa-plus"></i> '+wizard.i18n.addSection+"</a>",a+="</div>",a+="</div>"}(e.parts)+"</div>",l+='</div><div class="fw-clearfix"></div></div>'}function u(e,i){var t='<div class="postbox">';return t+='<div class="fw-movediv hndle ui-sortable-handle"><i class="fa fa-arrows"></i></div>',t+='<h1 class="fw-step-h1 hndle ui-sortable-handle"><span>',t+=e.title+"</span></h1>",t+='<div class="fw-step-controls">',t+='<i class="fa fa-remove fw-remove-step" title="'+wizard.i18n.tooltips.removeStep+'" aria-hidden="true"></i>',t+='<i class="fa fa-caret-up fw-toggle-step" aria-hidden="true"></i>',t+='<i class="fa fa-files-o fw-duplicate-step" title="duplicate step" aria-hidden="true"></i>',t+="</div>",t+='<div class="fw-clearfix"></div>',t+=p(e,i),t+='<div class="fw-clearfix"></div>',t+="</div>"}function b(e){var i={};switch(i.type=e.attr("data-type")){case"radio":!function(e,i){var t=i.elements=[];e.find(".fw-radio-option-element").each(function(e,i){t.push(function(e){var i={type:e.attr("data-type"),value:null};return"option"===i.type?i.value=e.find(".fw-radio-option").val():"header"===i.type&&(i.value=e.find(".fw-radio-header").val()),i}(n(i)))}),i.required=e.find(".fw-required").prop("checked"),i.multichoice=e.find(".fw-radio-multichoice").prop("checked")}(e,i);break;case"select":!function(e,i){var t=e.find(".fw-select-options").val().split("\n");i.required=e.find(".fw-required").prop("checked"),i.search=e.find(".fw-select-search").prop("checked"),i.label=e.find(".fw-block-label").val(),i.placeholder=e.find(".fw-select-placeholder").val(),i.elements=t.filter(function(e){return""!==e&&" "!==e})}(e,i);break;case"checkbox":!function(e,i){i.label=e.find(".fw-text-label").val(),i.required=e.find(".fw-required").prop("checked")}(e,i);break;case"text":!function(e,i){i.label=e.find(".fw-text-label").val(),i.required=e.find(".fw-required").prop("checked")}(e,i);break;case"email":!function(e,i){i.label=e.find(".fw-text-label").val(),i.required=e.find(".fw-required").prop("checked")}(e,i);break;case"numeric":!function(e,i){i.label=e.find(".fw-text-label").val(),i.required=e.find(".fw-required").prop("checked"),i.minimum=e.find(".fw-numeric-minimum").val(),i.maximum=e.find(".fw-numeric-maximum").val()}(e,i);break;case"file":!function(e,i){i.label=e.find(".fw-text-label").val(),i.required=e.find(".fw-required").prop("checked"),i.multi=e.find(".fw-file-multi").prop("checked")}(e,i);break;case"date":!function(e,i){i.label=e.find(".fw-text-label").val(),i.format=e.find(".fw-date-format").val(),i.required=e.find(".fw-required").prop("checked")}(e,i);break;case"textarea":!function(e,i){i.label=e.find(".fw-textarea-label").val(),i.required=e.find(".fw-required").prop("checked")}(e,i);break;case"paragraph":!function(e,i){i.text=e.find(".fw-paragraph-text").val()}(e,i);break;case"media":!function(e,i){i.attachmentId=e.find(".fw-media-element").val()}(e,i);break;case"regex":!function(e,i){i.label=e.find(".fw-text-label").val(),i.filter=e.find(".fw-regex-filter").val(),i.customError=e.find(".fw-regex-error").val(),i.required=e.find(".fw-required").prop("checked")}(e,i);break;case"registration":!function(e,i){i.required=e.find(".fw-required").prop("checked"),i.password=e.find(".msfp-registration-password").prop("checked"),i.firstname=e.find(".msfp-registration-firstname").prop("checked"),i.lastname=e.find(".msfp-registration-lastname").prop("checked"),i.website=e.find(".msfp-registration-website").prop("checked"),i.bio=e.find(".msfp-registration-bio").prop("checked")}(e,i)}return i}function w(e){var i={};i.title=e.find(".fw-part-title").val();var a=i.blocks=[];return e.find(".fw-step-block").each(function(e,i){var t=n(i);t.find(".msfp-conditional").prop("checked")?a.push(function(e){var i={type:"conditional"};return i.visible=e.find(".msfp-conditional-visible").val(),i.prec_block_id=e.find(".msfp-conditional-prec-block-id").val(),i.prec_operator=e.find(".msfp-conditional-prec-op").val(),i.prec_value=e.find(".msfp-conditional-prec-value").val(),i.block=b(e),i}(t)):a.push(b(t))}),i}function m(e){var t={title:e.find(".fw-step-title").val(),headline:e.find(".fw-step-headline").val(),copy_text:e.find(".fw-step-copy_text").val(),parts:[]};return e.find(".fw-step-part").each(function(e,i){t.parts.push(w(n(i)))}),t}function i(e){var i=!0;return""===e.title?(i=!1,c(wizard.i18n.alerts.noFormTitle,!1)):i=function(e){for(var i=!0,t=0;t<e.length;t++)if(e[t].title)for(var a=0;a<e[t].parts.length;a++){""===e[t].parts[a].title&&(i=!1,c(wizard.i18n.alerts.noSectionTitle,!1));for(var l=0;l<e[t].parts[a].blocks.length;l++)e[t].parts[a].blocks[l]}else i=!1,c(wizard.i18n.alerts.noStepTitle,!1);return i}(e.wizard.steps)&&function(e){var i=!0;return function(e){return!!e&&/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}(e.to)?e.subject||(i=!1,n("#fw-nav-settings").trigger("click"),c(wizard.i18n.alerts.noSubject,!1)):(i=!1,n("#fw-nav-settings").trigger("click"),c(wizard.i18n.alerts.invalidEmail,!1)),i}(e.wizard.settings),i}function v(){var e=n(l),t={wizard:{title:n(".fw-wizard-title").val(),steps:[],settings:{thankyou:n(".fw-settings-thankyou").val(),to:n(".fw-mail-to").val(),frommail:n(".fw-mail-from-mail").val(),fromname:n(".fw-mail-from-name").val(),subject:n(".fw-mail-subject").val(),header:n(".fw-mail-header").val(),headers:n(".fw-mail-headers").val()}}},a=e.find(".fw-step");a.each(function(e,i){a.length;t.wizard.steps.push(m(n(i)))}),t.wizard.steps.push(),i(t)&&(r("save",t),n.ajax({type:"POST",url:wizard.ajaxurl,dataType:"json",data:{action:"fw_wizard_save",data:t,nonce:wizard.nonce,id:wizard.id},success:function(e){void 0!==e.data.nonce&&(wizard.nonce=e.data.nonce),wizard.id=e.data.id,c(e.data.msg,e.success)},error:function(e){r("fail",arguments),r("response",e)}}))}function h(){n(".meta-box-sortables").sortable({opacity:.6,revert:!0,cursor:"move",handle:".hndle",tolerance:"pointer",placeholder:"fw-block-placeholder",start:function(e,i){var t=n(i.item).height();n(".fw-block-placeholder").height(t)},update:function(e,i){o("sortables update",e,i),n(i.item).removeAttr("style"),h(),k()}}),n(".fw-step-part .inside").sortable({opacity:.6,cursor:"move",connectWith:".connectedSortable",handle:".fw-block-hndle",tolerance:"intersect",placeholder:"fw-block-placeholder",revert:100,start:function(e,i){var t=n(i.item).height(),a=n(".fw-block-placholder");a.height(t),a.attr("data-type",i.item.attr("data-type"))},update:function(e,i){var t=n(i.item).attr("data-type"),a=-1;if(n(i.item).is(".fw-draggable-block"))if("registration"===t&&z())c(wizard.i18n.alerts.onlyOneRegistration,!1),n(i.item).remove();else{var l=n(d({type:t,label:""}));n(i.item).replaceWith(l),r("New block: ",l+" "+(a=n(".fw-step-block").index(l)))}h(),k(),A(),msfp&&setupConditionals(a)}}),n(".fw-parts-container").sortable({opacity:.6,cursor:"move",connectWith:".fw-parts-container",handle:".fw-section-hndle",tolerance:"intersect",placeholder:"fw-section-placeholder",revert:100,start:function(e,i){var t=n(i.item).height();n(".fw-section-placeholder").height(t)},update:function(e,i){h(),k(),A()}}),n(t+" .fw-draggable-block").draggable({connectToSortable:".fw-step-part .inside",revert:"invalid",helper:"clone",cursor:"move"}),n(l).find(".fw-step-title").on("change input",e)}function k(){n(".fa-info-circle").tooltip(),n(".fw-remove-step").tooltip(),n(".fw-duplicate-step").tooltip(),n(".fw-remove-part").tooltip(),n(".fw-remove-block").tooltip(),n(".hndle.ui-sortable-handle").tooltip()}function e(e){var i=n(this);r("titleOnChangeU",i.val()),i.closest(".postbox").find("h1 > span").html(i.val().toString())}function g(e){e.find('.fw-radio-option-element[data-type="option"] > label').each(function(e,i){r("updateOptions",i),n(i).html("Option "+(e+1))})}function x(e){var i=n(".fw-step").length;if(i<5||msfp)if(i<10){var t=n(u(e,i));t.appendTo(n(l).find(".meta-box-sortables")),A(),h(),C(),0<i&&n("html, body").animate({scrollTop:n(document).height()-t.height()-180},500)}else c(wizard.i18n.alerts.onlyTen,!1);else c(wizard.i18n.alerts.onlyFive,!1)}function y(e){var i="";return"true"==e&&(i="checked"),i}function z(){var t=!1;return n(".fw-step-block").each(function(e,i){"registration"==n(i).attr("data-type")&&(t=!0)}),t}function q(){var e=n(this).closest(".postbox");!0===confirm(wizard.i18n.alerts.reallyDeleteStep)&&e.slideUp(700,function(){e.remove()})}function _(e){var i=n(e.target).closest(".fw-step-part");!0===confirm(wizard.i18n.alerts.reallyDeleteSection)&&i.slideUp(500,function(){i.remove()})}function C(){n(".thickbox").click(function(a){n("#fw-thickbox-radio").unbind("click").click(function(e){tb_remove();var i=n(d({type:"radio"}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-select").unbind("click").click(function(e){tb_remove();var i=n(d({type:"select",label:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-text").unbind("click").click(function(e){tb_remove();var i=n(d({type:"text",label:"",value:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-email").unbind("click").click(function(e){tb_remove();var i=n(d({type:"email",label:"",value:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-numeric").unbind("click").click(function(e){tb_remove();var i=n(d({type:"numeric",label:"",value:"",minimum:"",maximum:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-file").unbind("click").click(function(e){tb_remove();var i=n(d({type:"file",label:"",value:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A()}),n("#fw-thickbox-textarea").unbind("click").click(function(e){tb_remove();var i=n(d({type:"textarea",label:"",value:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-date").unbind("click").click(function(e){tb_remove();var i=n(d({type:"date",label:"",format:"yy-mm-dd"}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),k(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-paragraph").unbind("click").click(function(e){tb_remove();var i=n(d({type:"paragraph",text:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),k(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-media").unbind("click").click(function(){tb_remove();var e=n(d({type:"media",attachmentId:0}));n(a.target).parents(".fw-step-part").find(".inside").append(e),A(),k(),msfp&&setupConditionals(n(".fw-step-block").index(e))}),n("#fw-thickbox-regex").unbind("click").click(function(e){tb_remove();var i=n(d({type:"regex",label:"",filter:"",customError:""}));n(a.target).parents(".fw-step-part").find(".inside").append(i),A(),msfp&&setupConditionals(n(".fw-step-block").index(i))}),n("#fw-thickbox-registration").unbind("click").click(function(e){tb_remove();var i=n(d({type:"registration",label:"",value:""})),t=n(a.target).parents(".fw-step-part");z()?c(wizard.i18n.alerts.onlyOneRegistration,!1):t.find(".inside").append(i),A()})})}function S(e){if(-1!=n("input[type=text]").index(n(e.target))){var i=n(e.target).val();Array.isArray(i)&&(i=i.join(" ")),i=i.toString(),(-1==n.inArray(e.keyCode,[37,38,39,40,48,49,50,51,52,53,54,55,56,57,58,96,97,98,99,100,101,102,103,104,105,8,13,189])||189==e.keyCode&&-1!=i.indexOf("-")||198==e.keyCode&&0!=i.length)&&e.preventDefault()}}function j(e,i){var t=i.url,a=i.title,l=i.filename;switch(i.type){case"image":i.sizes.thumbnail.url&&(t=i.sizes.thumbnail.url);break;case"video":i.thumb.src?t=i.thumb.src:i.icon&&(t=i.icon)}e.find(".fw-media-preview").attr("src",t),e.find(".fw-media-element").val(i.id),e.find(".fw-media-element-title").val(a),e.find(".fw-media-element-filename").val(l)}var T=null;function O(e){e.preventDefault();var i=n(e.target).parent();if(T)return T.msf_block=i,void T.open();(T=wp.media({title:wizard.i18n.media.frame_title,multiple:!1})).msf_block=i,T.on("close",function(){j(T.msf_block,T.state().get("selection").first().toJSON())}),T.on("open",function(){var e=T.msf_block,i=T.state().get("selection"),t=e.find(".fw-media-element").val(),a=wp.media.attachment(t);a.fetch(),i.add(a?[a]:[])}),T.open()}function A(){n(".fw-element-step").unbind("click").click(function(e){x({title:"",headline:"",copy_text:"",parts:[{title:"",blocks:[]}]})}),n(".fw-duplicate-step").unbind("click").click(function(e){!function(e){var i=m(e);i.title+=" (COPY)",x(i)}(n(this).parent().parent().find(".fw-step"))}),n(".fw-add-part").unbind("click").click(function(e){!function(e){var i=e.target,t=f({title:"",blocks:[]},"fw-step-part");n(i).closest(".fw-step-parts").find(".fw-parts-container").append(t),n(".fw-remove-part").click(function(e){_(e)}),C()}(e),h()}),n(".fw-toggle-step").unbind("click").click(function(e){n(this).parent().parent().find(".fw-step").slideToggle(),n(this).toggleClass("fw-icon-rotated")}),n(".fw-remove-part").unbind("click").click(function(e){_(e)}),n(".fw-remove-block").unbind("click").click(function(e){!function(e){var i=n(e.target).closest(".fw-step-block"),t=i.find(".fw-block-label").val();!0===confirm(wizard.i18n.alerts.reallyDeleteBlock+"\n\n"+t)&&i.slideUp(300,function(){i.remove()})}(e)}),n(".fw-toggle-block").unbind("click").click(function(e){var i=n(this).parent().parent();if(i.toggleClass("fw-block-collapsed"),i.hasClass("fw-block-collapsed")){var t=i.find(".fw-block-label").val();Array.isArray(t)&&(t=t.join(" ")),i.find("h4").text(t),n(this).addClass("fw-icon-rotated")}else{var a=i.data("type");i.find("h4").text(a),n(this).removeClass("fw-icon-rotated")}})}n(document).ready(function(){try{var e=JSON.parse(wizard.json),i=n(l);e.wizard.title?n(".fw-wizard-title").val(e.wizard.title):n(".fw-wizard-title").val("My Multi Step Form"),function(e){var i,t,a='<div class="postbox-container"><div class="metabox-holder"><div class="meta-box-sortables">';for(i=0,t=e.length;i<t;i++)a+=u(e[i],i);a+="</div>",a+='<a class="fw-element-step"><i class="fa fa-plus"></i> '+wizard.i18n.addStep+"</a>",a+="</div></div>",n(l).html(a)}(e.wizard.steps&&0<e.wizard.steps.length?e.wizard.steps:[{title:"",headline:"",copy_text:"",parts:[{title:"",blocks:[]}]}]),function(e){e&&(e.thankyou&&n(".fw-settings-thankyou").val(e.thankyou),e.subject&&n(".fw-mail-subject").val(e.subject),e.to&&n(".fw-mail-to").val(e.to),e.frommail&&n(".fw-mail-from-mail").val(e.frommail),e.fromname&&n(".fw-mail-from-name").val(e.fromname),e.header&&n(".fw-mail-header").val(e.header),e.headers&&n(".fw-mail-headers").val(e.headers))}(e.wizard.settings),n(".fw-button-save").click(v),n(window).scroll(function(){n(".nav-tab-wrapper").position().top+n(".nav-tab-wrapper").height()+9<n(this).scrollTop()?n(t).addClass("fw-sticky"):n(t).removeClass("fw-sticky")}),i.on("click",".postbox .handlediv",function(){n(this).closest(".postbox").toggleClass("closed")}),i.on("click",".fw-radio-add",function(){var e=n(this).prev(".fw-radio-option-container"),i=s("",e.children(".fw-radio-option-element").length);n(i).appendTo(e),g(e)}),i.on("click",".fw-remove-radio-option",function(){r("remove on click");var e=n(this),i=e.closest(".fw-radio-option-container");e.closest(".fw-radio-option-element").remove(),g(i)}),i.on("keydown",".fw-numeric-minimum",S),i.on("keydown",".fw-numeric-maximum",S),i.on("click",".fw-media-select",O),i.on("click",".fw-remove-step",q),h(),k(),C(),A(),function(e){e.find(".fw-media-element").each(function(){if("0"!==n(this).val().toString()){var i=n(this).parent();wp.media.attachment(n(this).val()).fetch({success:function(e){j(i,e.attributes)}})}})}(i),n("#fw-nav-settings").click(function(e){n("#fw-nav-steps").toggleClass("nav-tab-active"),n("#fw-nav-settings").toggleClass("nav-tab-active"),n(l).hide(),n(t).hide(),n(".fw-mail-settings-container").show()}),n("#fw-nav-steps").click(function(e){n("#fw-nav-steps").toggleClass("nav-tab-active"),n("#fw-nav-settings").toggleClass("nav-tab-active"),n(".fw-mail-settings-container").hide(),n(l).show(),n(t).show()}),n("#fw-elements-modal").dialog({dialogClass:"wp-dialog",modal:!0,autoOpen:!1,closeOnEscape:!0,buttons:{Close:function(){n(this).dialog("close")}}})}catch(e){o(e)}})}(jQuery);